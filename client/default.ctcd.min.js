!function(){function a(){var a=200;$(".f-wrapper").scroll(function(b){var c=$(".f-wrapper .list").offset().top;a>c&&180>c?$(".f-head").addClass("up"):c>150&&$(".f-head").removeClass("up"),a=c});for(var c=$("#f-list").children(),f=0;f<c.length;f++)c[f].index=f,b(c[f],"click",function(a){history.pushState("","","/m/"+(this.index+1)),d.css("display","none"),i.refreshSteps(this.index),e.css("display","block")});window.onpopstate=function(a){a.preventDefault(),d.css("display","block"),e.css("display","none")}}function b(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,function(){c.call(a)})}function c(a,b){if(h[a])return b(null,h[a]);var c=window.location.origin;$.ajax({url:c+"/api/ctcd/movements/"+a,type:"GET",success:function(c){return h[a]=c,b(null,c)}})}var d=$(".f-body"),e=$(".s-body"),f={w:window.screen.width,h:window.screen.height},g={},h={};a();var i={init:function(){g={sStepsView:document.getElementById("s-step"),sStepsList:document.getElementById("s-list"),tagsView:document.getElementById("tags"),iCount:10,iW:f.w>450?450:f.w,iNow:0,iX:0,iDirect:"l",iStartX:0,iStartTouchX:0},g.sStepsList.style.width=g.iW*g.iCount+"px",g.sStepsList.style.height="100%";for(var a=0;a<g.iCount;a++){var c=document.createElement("li");c.className="item";var d=document.createElement("div");d.className="wrapper";var e=document.createElement("a");d.appendChild(e),c.appendChild(d),g.tagsView.appendChild(c)}g.arrNav=g.tagsView.children;for(var a=0;a<g.iCount;a++)g.arrNav[a].index=a,b(g.arrNav[a],"click",i.clickHandler);b(g.sStepsView,"touchstart",i.touchStartHandler),b(g.sStepsView,"touchmove",i.touchMoveHandler),b(g.sStepsView,"touchend",i.touchEndHandler)},touchStartHandler:function(a){g.sStepsList.style.transition="none",g.iStartTouchX=a.changedTouches[0].pageX,g.iStartTouchY=a.changedTouches[0].pageY,g.iStartX=g.iX,clearInterval(g.oTimer)},touchMoveHandler:function(a){var b=a.changedTouches[0].pageY-g.iStartTouchY,c=a.changedTouches[0].pageX-g.iStartTouchX;c>0?g.iDirect="r":g.iDirect="l",b>5||-5>b||(g.iX=g.iStartX+c,g.iX>-3&&(g.iX=0),g.iX<-g.iW*(g.iCount-1)+3&&(g.iX=-g.iW*(g.iCount-1)),g.sStepsList.style.WebkitTransform=g.sStepsList.style.transform="translateX("+g.iX+"px)",a.preventDefault(),a.stopPropagation())},touchEndHandler:function(a){var b=g.iX/g.iW;console.log(b),console.log(g.iNow),console.log(b.toFixed(2).slice(-2)),console.log(g.iDirect),"l"===g.iDirect&&b.toFixed(2).slice(-2)>=10?g.iNow=-parseInt(b)+1:"r"===g.iDirect&&b.toFixed(2).slice(-2)<=90&&(g.iNow=-parseInt(b)),console.log(g.iNow),g.iNow<0&&(g.iNow=0),g.iNow>g.iCount-1&&(g.iNow=g.iCount-1),i.slide()},slide:function(){g.iX=-g.iNow*g.iW,g.sStepsList.style.transition="0.5s",g.sStepsList.style.WebkitTransform=g.sStepsList.style.transform="translateX("+g.iX+"px)";for(var a=0;a<g.iCount;a++)i.removeClass(g.arrNav[a],"active"),i.removeClass(g.arrNav[a].childNodes[0],"active");i.addClass(g.arrNav[g.iNow],"active"),i.addClass(g.arrNav[g.iNow].childNodes[0],"active")},refreshSteps:function(a){c(a,function(a,b){if(!a&&b){g.iX=0,g.sStepsList.innerHTML="";for(var c=0;c<g.iCount;c++){var d=i.createStepDom(b[c+1]);d.style.width=g.iW+"px",g.sStepsList.appendChild(d),g.sStepsList.style.WebkitTransform=g.sStepsList.style.transform="",g.arrNav[c].firstChild.firstChild.text=b[c+1].name,0==c?(i.addClass(g.arrNav[c],"active"),i.addClass(g.arrNav[c].childNodes[0],"active")):(i.removeClass(g.arrNav[c],"active"),i.removeClass(g.arrNav[c].childNodes[0],"active"))}}})},addClass:function(a,b){var c=a.className.split(" ");if(!a.className)return void(a.className=b);for(var d=0,e=c.length;e>d;d++)if(c[d]===b)return;a.className+=" "+b},removeClass:function(a,b){var c=a.className.split(" ");if(a.className)for(var d=0,e=c.length;e>d;d++)if(c[d]===b){c.splice(d,1),a.className=c.join(" ");break}},clickHandler:function(){g.iNow=this.index,i.slide()},createStepDom:function(a){var b=document.createElement("li");b.innerHTML='<div class="item"><div class="title"><h4>动作</h4></div><div class="content">&nbsp;&nbsp;&nbsp;&nbsp;'+a.description+"</div></div>";for(var c='<div class="item"><div class="title"><h4>图解</h4></div><div class="content">',d=0;d<a.imgList.length;d++)c+=a.imgList[d].description+'<img src="http://7xl4qs.com1.z0.glb.clouddn.com/'+a.imgList[d].imgUrl+'?imageMogr2/thumbnail/250x250" alt="'+a.imgList[d].description+'"/>';c+="</div></div>",b.innerHTML+=c,b.innerHTML+='<div class="item"><div class="title"><h4>心得</h4></div><div class="content">&nbsp;&nbsp;&nbsp;&nbsp;'+a.analysis+"</div></div>",c='<div class="item"><div class="title"><h4>训练目标</h4></div><div class="content">';for(var d=0;d<a.level.length;d++)c+='<div class="tar">'+a.level[d].description+"</div>";return c+="</div></div>",b.innerHTML+=c,b.innerHTML+='<div class="item"><div class="title"><h4>稳扎稳打</h4></div><div class="content">&nbsp;&nbsp;&nbsp;&nbsp;'+a.suggest+"</div>",b}};i.init()}();